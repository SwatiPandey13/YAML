steps:
- script: |
    echo "Starting cross-project checkout..."
    mkdir -p snyk-config
    cd snyk-config
    
    # Initialize with explicit authentication
    git init --initial-branch=main
    git config core.sparseCheckout true
    
    # Use full cross-project URL format
    git remote add origin "https://$(System.AccessToken)@dev.azure.com/$(System.TeamProject)/_git/snyk-policy-config?path=/&version=GBmain"
    
    echo "SAST_configs" > .git/info/sparse-checkout
    echo "SCA_configs" >> .git/info/sparse-checkout
    
    # Fetch with explicit authentication header
    git -c http.extraHeader="Authorization: Bearer $(System.AccessToken)" fetch --depth=1 origin main
    git checkout FETCH_HEAD
    
    # Copy files
    cp -r SAST_configs ../
    cp -r SCA_configs ../
  displayName: 'Cross-project Snyk config checkout'
  env:
    GIT_TERMINAL_PROMPT: 0
